{{ define "main" }}
<section class="page-header">
    <div class="container">
        <h1>{{ .Title }}</h1>
        {{ if .Params.subtitle }}
        <h2>{{ .Params.subtitle }}</h2>
        {{ end }}
        <p>{{ .Date.Format "January 2, 2006" }} ‚Ä¢ {{ .Params.location }}</p>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="content-card">
            <div class="match-score" style="margin-bottom: 2rem;">
                <div class="team">
                    <span class="team-name">{{ .Params.team_home }}</span>
                </div>
                <div class="score">{{ .Params.score_home }} : {{ .Params.score_away }}</div>
                <div class="team">
                    <span class="team-name">{{ .Params.team_away }}</span>
                </div>
            </div>

            <h2>Match Report</h2>
            {{ .Content }}
        </div>

        {{ if .Params.match_id }}
        {{ $matchData := index .Site.Data.matches .Params.match_id }}
        {{ $galleryItems := default (default (default slice $matchData.items) $matchData.gallery) $matchData.media }}
        {{ if $galleryItems }}
        <h2 class="text-center" style="color: var(--secondary-color); margin: 3rem 0 2rem;">Match Gallery</h2>
        
        <!-- Gallery Grid -->
        <div class="gallery-grid">
            {{ range $galleryItems }}
            {{ $filename := . }}
            {{ if reflect.IsMap . }}
                {{ $filename = .file }}
            {{ end }}
            {{ $mediaURL := printf "https://media.rustyploughfc.com/%s" $filename }}
            {{ $ext := path.Ext $filename }}
            {{ if or (eq $ext ".mov") (eq $ext ".mp4") (eq $ext ".MOV") (eq $ext ".MP4") }}
            <div class="gallery-item" data-src="{{ $mediaURL }}" data-type="video">
                <video src="{{ $mediaURL }}" preload="metadata"></video>
                <div class="play-icon">‚ñ∂</div>
            </div>
            {{ else }}
            <div class="gallery-item" data-src="{{ $mediaURL }}">
                <img src="{{ $mediaURL }}" alt="Match photo" loading="lazy">
            </div>
            {{ end }}
            {{ end }}
        </div>
        {{ else if .Params.match_id }}
        <div class="content-card" style="margin-top: 3rem;">
            <p><strong>üì∏ Add photos and videos for this match:</strong></p>
            <ol style="margin-top: 1rem; margin-left: 2rem;">
                <li>Upload your files to R2 at <code>media.rustyploughfc.com</code></li>
                <li>Edit <code>hugo-site/data/matches/{{ .Params.match_id }}.yaml</code></li>
                <li>Add the filenames to the <code>images:</code> or <code>videos:</code> list</li>
                <li>Commit and push!</li>
            </ol>
        </div>
        {{ end }}
        {{ end }}

        <div style="text-align: center; margin-top: 3rem;">
            <a href="{{ "/international/" | relURL }}" style="color: var(--secondary-color); font-weight: 600;">‚Üê Back to International Competitions</a>
        </div>
    </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
    <button class="lightbox-nav lightbox-prev" onclick="changeImage(-1)">&#10094;</button>
    <div class="lightbox-content" id="lightbox-content">
        <!-- Content will be dynamically inserted -->
    </div>
    <button class="lightbox-nav lightbox-next" onclick="changeImage(1)">&#10095;</button>
    <div class="lightbox-caption" id="lightbox-caption"></div>
</div>
{{ end }}

{{ define "scripts" }}
<script src="{{ "js/gallery.js" | relURL }}"></script>
{{ end }}
